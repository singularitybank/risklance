// Risk Lance - ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ JavaScript

// ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ç®¡ç†
class RiskLanceApp {
    constructor() {
        this.currentUser = null;
        this.currentScreen = 'dashboard';
        this.notifications = [];
        this.insuranceData = [];
        this.riskData = {};
        this.businessData = {};

        this.init();
    }

    init() {
        console.log('RiskLanceApp init called'); // ãƒ‡ãƒãƒƒã‚°ç”¨
        this.setupEventListeners();
        this.loadDummyData();
        this.showLoginScreen();
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
    setupEventListeners() {
        // ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ 
        const loginForm = document.getElementById('login-form');
        if (loginForm) {
            loginForm.addEventListener('submit', (e) => this.handleLogin(e));
        }

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³
        const logoutBtn = document.getElementById('logout-btn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', () => this.handleLogout());
        }

        // ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼
        const menuItems = document.querySelectorAll('.menu-item');
        menuItems.forEach(item => {
            item.addEventListener('click', (e) => this.handleMenuClick(e));
        });

        // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³
        this.setupActionButtons();
    }

    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®è¨­å®š
    setupActionButtons() {
        // ä¿é™ºè¦‹ç›´ã—ãƒœã‚¿ãƒ³
        const actionBtns = document.querySelectorAll('.action-btn');
        actionBtns.forEach(btn => {
            btn.addEventListener('click', (e) => this.handleActionClick(e));
        });

        // ãŠã™ã™ã‚ãƒœã‚¿ãƒ³
        const recommendBtns = document.querySelectorAll('.recommend-btn');
        recommendBtns.forEach(btn => {
            btn.addEventListener('click', (e) => this.handleRecommendationClick(e));
        });
    }

    // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
    handleLogin(e) {
        e.preventDefault();

        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        console.log('ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œ:', username, password); // ãƒ‡ãƒãƒƒã‚°ç”¨

        // ç°¡å˜ãªèªè¨¼ï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰
        if (username && password) {
            this.currentUser = {
                name: 'ç”°ä¸­å¤ªéƒ',
                company: 'æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«',
                role: 'ä»£è¡¨å–ç· å½¹'
            };

            console.log('ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸã€ç”»é¢åˆ‡ã‚Šæ›¿ãˆä¸­...'); // ãƒ‡ãƒãƒƒã‚°ç”¨
            this.showMainApp();
            this.updateUserInterface();
        } else {
            alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        }
    }

    // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
    handleLogout() {
        if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
            this.currentUser = null;
            this.showLoginScreen();
        }
    }

    // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
    handleMenuClick(e) {
        const menuItem = e.currentTarget;
        const screenName = menuItem.getAttribute('data-screen');

        if (screenName) {
            this.switchScreen(screenName);
            this.updateActiveMenu(menuItem);
        }
    }

    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
    handleActionClick(e) {
        const actionType = e.currentTarget.getAttribute('data-action') || 'default';

        switch (actionType) {
            case 'fire-insurance':
                this.showInsuranceDetails('ç«ç½ä¿é™º');
                break;
            case 'cyber-security':
                this.showInsuranceRecommendation('ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¿é™º');
                break;
            default:
                this.showActionDialog('å¯¾å¿œä¸­', 'ã“ã®æ©Ÿèƒ½ã¯ç¾åœ¨é–‹ç™ºä¸­ã§ã™ã€‚');
        }
    }

    // ãŠã™ã™ã‚ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
    handleRecommendationClick(e) {
        const recommendationType = e.currentTarget.getAttribute('data-recommendation') || 'default';

        switch (recommendationType) {
            case 'cyber-insurance':
                this.showInsuranceRecommendation('ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¿é™º');
                break;
            case 'fire-coverage':
                this.showCoverageReview('ç«ç½ä¿é™º');
                break;
            default:
                this.showRecommendationDialog('è©³ç´°æƒ…å ±', 'ã“ã®ä¿é™ºå•†å“ã«ã¤ã„ã¦è©³ã—ã„æƒ…å ±ã‚’ã”æ¡ˆå†…ã—ã¾ã™ã€‚');
        }
    }

    // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
    switchScreen(screenName) {
        // å…¨ã¦ã®ç”»é¢ã‚’éè¡¨ç¤º
        const screens = document.querySelectorAll('.content-screen');
        screens.forEach(screen => screen.classList.remove('active'));

        // æŒ‡å®šã•ã‚ŒãŸç”»é¢ã‚’è¡¨ç¤º
        const targetScreen = document.getElementById(screenName);
        if (targetScreen) {
            targetScreen.classList.add('active');
            this.currentScreen = screenName;

            // ç”»é¢å›ºæœ‰ã®åˆæœŸåŒ–å‡¦ç†
            this.initializeScreen(screenName);
        }
    }

    // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®æ›´æ–°
    updateActiveMenu(activeItem) {
        const menuItems = document.querySelectorAll('.menu-item');
        menuItems.forEach(item => item.classList.remove('active'));
        activeItem.classList.add('active');
    }

    // ç”»é¢å›ºæœ‰ã®åˆæœŸåŒ–
    initializeScreen(screenName) {
        switch (screenName) {
            case 'dashboard':
                this.updateDashboard();
                break;
            case 'business-apps':
                this.updateBusinessApps();
                break;
            case 'risk-analysis':
                this.updateRiskAnalysis();
                break;
            case 'risk-branding':
                this.updateRiskBranding();
                break;
            case 'insurance-portfolio':
                this.updateInsurancePortfolio();
                break;
        }
    }

    // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ›´æ–°
    updateDashboard() {
        // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
        this.simulateDataUpdate();
    }

    // æ¥­å‹™ã‚¢ãƒ—ãƒªæ›´æ–°
    updateBusinessApps() {
        // æœ¬æ—¥ã®å¤‰æ›´ç‚¹ã‚’æ›´æ–°
        this.updateTodayChanges();
    }

    // ãƒªã‚¹ã‚¯åˆ†ææ›´æ–°
    updateRiskAnalysis() {
        // ãƒªã‚¹ã‚¯ãƒ¡ãƒ¼ã‚¿ãƒ¼ã®æ›´æ–°
        this.updateRiskMeters();

        // ç·Šæ€¥ã‚¢ãƒ©ãƒ¼ãƒˆã®è¡¨ç¤º
        this.displayEmergencyAlerts();

        // ç¤¾å†…ãƒªã‚¹ã‚¯ã‚°ãƒ©ãƒ•ã®æ›´æ–°
        this.updateInternalRiskCharts();

        // ç¤¾å¤–ãƒªã‚¹ã‚¯ã‚°ãƒ©ãƒ•ã®æ›´æ–°
        this.updateExternalRiskCharts();

        // ç·åˆãƒªã‚¹ã‚¯ã‚µãƒãƒªãƒ¼ã®æ›´æ–°
        this.updateRiskSummary();
    }

    // ç·Šæ€¥ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º
    displayEmergencyAlerts() {
        const alertsContainer = document.querySelector('.emergency-alerts');
        if (!alertsContainer || !this.emergencyAlerts) return;

        this.emergencyAlerts.forEach(alert => {
            const alertElement = alertsContainer.querySelector(`[data-alert-id="${alert.id}"]`);
            if (alertElement) {
                // æ—¢å­˜ã®ã‚¢ãƒ©ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
                const actionBtn = alertElement.querySelector('.alert-action');
                if (actionBtn) {
                    actionBtn.addEventListener('click', () => this.handleAlertAction(alert));
                }
            }
        });
    }

    // ã‚¢ãƒ©ãƒ¼ãƒˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†
    handleAlertAction(alert) {
        switch (alert.level) {
            case 'critical':
                this.showCriticalAlertDialog(alert);
                break;
            case 'high':
                this.showHighAlertDialog(alert);
                break;
            default:
                this.showAlertDialog(alert);
        }
    }

    // ç¤¾å†…ãƒªã‚¹ã‚¯ãƒãƒ£ãƒ¼ãƒˆæ›´æ–°
    updateInternalRiskCharts() {
        // åœ¨åº«æ¨ç§»æ£’ã‚°ãƒ©ãƒ•ã®æ›´æ–°
        this.updateInventoryChart();

        // å¾“æ¥­å“¡ãƒªã‚¹ã‚¯å††ã‚°ãƒ©ãƒ•ã®æ›´æ–°
        this.updateEmployeeRiskChart();

        // ã‚·ã‚¹ãƒ†ãƒ è„†å¼±æ€§ç·šã‚°ãƒ©ãƒ•ã®æ›´æ–°
        this.updateVulnerabilityChart();
    }

    // åœ¨åº«æ¨ç§»ãƒãƒ£ãƒ¼ãƒˆæ›´æ–°
    updateInventoryChart() {
        const chartBars = document.querySelectorAll('#inventory-chart .bar');
        if (!chartBars.length || !this.internalRiskData.inventory) return;

        chartBars.forEach((bar, index) => {
            const trendData = this.internalRiskData.inventory.trends[index];
            if (trendData) {
                // ãƒãƒ¼ã®é«˜ã•ã¨ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã§æ›´æ–°
                setTimeout(() => {
                    bar.style.height = trendData.height;
                    if (trendData.warning) {
                        bar.classList.add('warning');
                    }

                    // ãƒ›ãƒãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã®è¿½åŠ 
                    bar.addEventListener('mouseenter', () => {
                        this.showInventoryTooltip(trendData, bar);
                    });
                }, index * 100);
            }
        });
    }

    // å¾“æ¥­å“¡ãƒªã‚¹ã‚¯ãƒãƒ£ãƒ¼ãƒˆæ›´æ–°
    updateEmployeeRiskChart() {
        const pieChart = document.getElementById('employee-risk-chart');
        if (!pieChart || !this.internalRiskData.employees) return;

        const employeeData = this.internalRiskData.employees;

        // å††ã‚°ãƒ©ãƒ•ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        setTimeout(() => {
            // ä¸­å¤®ã®åˆè¨ˆäººæ•°ã‚’æ›´æ–°
            const centerText = pieChart.querySelector('.total-employees');
            if (centerText) {
                centerText.textContent = `${employeeData.total}å`;
            }
        }, 500);
    }

    // ã‚·ã‚¹ãƒ†ãƒ è„†å¼±æ€§ãƒãƒ£ãƒ¼ãƒˆæ›´æ–°
    updateVulnerabilityChart() {
        const vulnerabilityChart = document.getElementById('vulnerability-chart');
        if (!vulnerabilityChart) return;

        // ç·šã‚°ãƒ©ãƒ•ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        const svgLine = vulnerabilityChart.querySelector('polyline');
        if (svgLine) {
            // ç·šã®æç”»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            const pathLength = svgLine.getTotalLength();
            svgLine.style.strokeDasharray = pathLength;
            svgLine.style.strokeDashoffset = pathLength;

            setTimeout(() => {
                svgLine.style.transition = 'stroke-dashoffset 2s ease-in-out';
                svgLine.style.strokeDashoffset = '0';
            }, 300);
        }
    }

    // ç¤¾å¤–ãƒªã‚¹ã‚¯ãƒãƒ£ãƒ¼ãƒˆæ›´æ–°
    updateExternalRiskCharts() {
        // åœ°åŸŸåˆ¥ç½å®³ãƒªã‚¹ã‚¯æ›´æ–°
        this.updateDisasterRiskMap();

        // å–å¼•å…ˆä¿¡ç”¨ãƒªã‚¹ã‚¯æ›´æ–°
        this.updateCreditRiskChart();

        // å¸‚å ´ç’°å¢ƒãƒªã‚¹ã‚¯æ›´æ–°
        this.updateMarketRiskGauge();
    }

    // ç½å®³ãƒªã‚¹ã‚¯ãƒãƒƒãƒ—æ›´æ–°
    updateDisasterRiskMap() {
        const riskRegions = document.querySelectorAll('.risk-region');
        if (!riskRegions.length || !this.externalRiskData.disasters) return;

        riskRegions.forEach((region, index) => {
            const disasterData = this.externalRiskData.disasters[index];
            if (disasterData) {
                // ãƒªã‚¹ã‚¯åœ°åŸŸã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
                region.addEventListener('click', () => {
                    this.showDisasterRiskDetails(disasterData);
                });

                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ
                setTimeout(() => {
                    region.style.transform = 'translateX(0)';
                    region.style.opacity = '1';
                }, index * 200);
            }
        });
    }

    // ä¿¡ç”¨ãƒªã‚¹ã‚¯ãƒãƒ£ãƒ¼ãƒˆæ›´æ–°
    updateCreditRiskChart() {
        const companyRisks = document.querySelectorAll('.company-risk');
        if (!companyRisks.length || !this.externalRiskData.creditRisk) return;

        companyRisks.forEach((company, index) => {
            const creditData = this.externalRiskData.creditRisk[index];
            if (creditData) {
                const riskFill = company.querySelector('.risk-fill');
                if (riskFill) {
                    // ãƒªã‚¹ã‚¯ãƒãƒ¼ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                    setTimeout(() => {
                        riskFill.style.width = `${creditData.score}%`;
                    }, index * 300);
                }

                // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
                company.addEventListener('click', () => {
                    this.showCreditRiskDetails(creditData);
                });
            }
        });
    }

    // å¸‚å ´ãƒªã‚¹ã‚¯ã‚²ãƒ¼ã‚¸æ›´æ–°
    updateMarketRiskGauge() {
        const gauge = document.querySelector('.gauge-needle');
        if (!gauge || !this.externalRiskData.marketRisk) return;

        const marketData = this.externalRiskData.marketRisk;

        // ã‚²ãƒ¼ã‚¸é‡ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        setTimeout(() => {
            gauge.style.transform = `translate(-50%, -100%) rotate(${marketData.gauge}deg)`;
        }, 500);
    }

    // ç·åˆãƒªã‚¹ã‚¯ã‚µãƒãƒªãƒ¼æ›´æ–°
    updateRiskSummary() {
        if (!this.riskSummary) return;

        // ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        this.animateCounters();

        // ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
        this.setupSummaryCardEvents();
    }

    // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    animateCounters() {
        const counters = [
            { selector: '.summary-card.critical .count', target: this.riskSummary.critical },
            { selector: '.summary-card.high .count', target: this.riskSummary.high },
            { selector: '.summary-card.medium .count', target: this.riskSummary.medium },
            { selector: '.summary-card.coverage .percentage', target: this.riskSummary.coverageRate, suffix: '%' }
        ];

        counters.forEach(counter => {
            const element = document.querySelector(counter.selector);
            if (element) {
                this.animateNumber(element, 0, counter.target, counter.suffix || 'ä»¶');
            }
        });
    }

    // æ•°å€¤ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    animateNumber(element, start, end, suffix) {
        const duration = 1000;
        const startTime = Date.now();

        const updateNumber = () => {
            const elapsed = Date.now() - startTime;
            const progress = Math.min(elapsed / duration, 1);
            const current = Math.floor(start + (end - start) * progress);

            element.textContent = current + suffix;

            if (progress < 1) {
                requestAnimationFrame(updateNumber);
            }
        };

        updateNumber();
    }

    // ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
    setupSummaryCardEvents() {
        const summaryCards = document.querySelectorAll('.summary-card');
        summaryCards.forEach(card => {
            card.addEventListener('click', () => {
                const cardType = card.classList[1]; // critical, high, medium, coverage
                this.showSummaryDetails(cardType);
            });
        });
    }

    // ãƒªã‚¹ã‚¯ãƒ–ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°æ›´æ–°
    updateRiskBranding() {
        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®æ›´æ–°
        this.updateRankings();
    }

    // ä¿é™ºãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªæ›´æ–°
    updateInsurancePortfolio() {
        // ä¿é™ºå¥‘ç´„ä¸€è¦§ã®æ›´æ–°
        this.updateInsuranceTable();
    }

    // ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢è¡¨ç¤º
    showLoginScreen() {
        console.log('showLoginScreen called'); // ãƒ‡ãƒãƒƒã‚°ç”¨

        const loginScreen = document.getElementById('login-screen');
        const mainApp = document.getElementById('main-app');

        console.log('åˆæœŸåŒ–æ™‚ loginScreen:', loginScreen); // ãƒ‡ãƒãƒƒã‚°ç”¨
        console.log('åˆæœŸåŒ–æ™‚ mainApp:', mainApp); // ãƒ‡ãƒãƒƒã‚°ç”¨

        if (loginScreen) {
            loginScreen.classList.add('active');
            console.log('login-screen activeã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ '); // ãƒ‡ãƒãƒƒã‚°ç”¨
        }

        if (mainApp) {
            mainApp.classList.remove('active');
            console.log('main-app activeã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤'); // ãƒ‡ãƒãƒƒã‚°ç”¨
        }
    }

    // ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªè¡¨ç¤º
    showMainApp() {
        console.log('showMainApp called'); // ãƒ‡ãƒãƒƒã‚°ç”¨

        const loginScreen = document.getElementById('login-screen');
        const mainApp = document.getElementById('main-app');

        console.log('loginScreen:', loginScreen); // ãƒ‡ãƒãƒƒã‚°ç”¨
        console.log('mainApp:', mainApp); // ãƒ‡ãƒãƒƒã‚°ç”¨

        if (loginScreen) {
            loginScreen.classList.remove('active');
            console.log('login-screen activeã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤'); // ãƒ‡ãƒãƒƒã‚°ç”¨
            console.log('login-screen ã‚¯ãƒ©ã‚¹ä¸€è¦§:', loginScreen.className); // ãƒ‡ãƒãƒƒã‚°ç”¨
        }

        if (mainApp) {
            mainApp.classList.add('active');
            console.log('main-app activeã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ '); // ãƒ‡ãƒãƒƒã‚°ç”¨
            console.log('main-app ã‚¯ãƒ©ã‚¹ä¸€è¦§:', mainApp.className); // ãƒ‡ãƒãƒƒã‚°ç”¨
            console.log('main-app computedStyle visibility:', window.getComputedStyle(mainApp).visibility); // ãƒ‡ãƒãƒƒã‚°ç”¨
            console.log('main-app computedStyle opacity:', window.getComputedStyle(mainApp).opacity); // ãƒ‡ãƒãƒƒã‚°ç”¨
        }
    }

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹æ›´æ–°
    updateUserInterface() {
        if (this.currentUser) {
            const userNameElement = document.querySelector('.user-name');
            if (userNameElement) {
                userNameElement.textContent = this.currentUser.name;
            }
        }
    }

    // ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    simulateDataUpdate() {
        // å£²ä¸Šãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°
        const salesValue = document.querySelector('.dashboard-cards .card:first-child .value');
        if (salesValue) {
            const currentValue = parseInt(salesValue.textContent.replace(/[Â¥,]/g, ''));
            const newValue = currentValue + Math.floor(Math.random() * 100000);
            salesValue.textContent = `Â¥${newValue.toLocaleString()}`;
        }

        // é€šçŸ¥ãƒãƒƒã‚¸ã®æ›´æ–°
        this.updateNotificationBadge();
    }

    // é€šçŸ¥ãƒãƒƒã‚¸æ›´æ–°
    updateNotificationBadge() {
        const badge = document.querySelector('.notification-badge');
        if (badge) {
            const count = Math.floor(Math.random() * 5) + 1;
            badge.textContent = count;
        }
    }

    // æœ¬æ—¥ã®å¤‰æ›´ç‚¹æ›´æ–°
    updateTodayChanges() {
        const timestamp = new Date().toLocaleTimeString('ja-JP', {
            hour: '2-digit',
            minute: '2-digit'
        });

        console.log(`${timestamp}: æ¥­å‹™ã‚¢ãƒ—ãƒªãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã—ãŸ`);
    }

    // ãƒªã‚¹ã‚¯ãƒ¡ãƒ¼ã‚¿ãƒ¼æ›´æ–°
    updateRiskMeters() {
        const meters = document.querySelectorAll('.meter-value');
        meters.forEach(meter => {
            const randomRotation = Math.floor(Math.random() * 180);
            meter.style.transform = `rotate(${randomRotation}deg)`;
        });
    }

    // ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ›´æ–°
    updateRankings() {
        console.log('ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
    }

    // ä¿é™ºãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
    updateInsuranceTable() {
        // ä¿é™ºå¥‘ç´„ã®æœŸé™ãƒã‚§ãƒƒã‚¯
        this.checkInsuranceExpiry();
    }

    // ä¿é™ºæœŸé™ãƒã‚§ãƒƒã‚¯
    checkInsuranceExpiry() {
        const today = new Date();
        const expiryThreshold = 30; // 30æ—¥å‰ã«è­¦å‘Š

        this.insuranceData.forEach(insurance => {
            const expiryDate = new Date(insurance.endDate);
            const daysUntilExpiry = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));

            if (daysUntilExpiry <= expiryThreshold && daysUntilExpiry > 0) {
                this.addNotification({
                    type: 'warning',
                    message: `${insurance.type}ã®æ›´æ–°æœŸé™ãŒè¿‘ã¥ã„ã¦ã„ã¾ã™ï¼ˆ${daysUntilExpiry}æ—¥å¾Œï¼‰`,
                    icon: 'fas fa-exclamation-triangle'
                });
            }
        });
    }

    // é€šçŸ¥è¿½åŠ 
    addNotification(notification) {
        this.notifications.push({
            ...notification,
            id: Date.now(),
            timestamp: new Date()
        });

        this.updateNotificationDisplay();
    }

    // é€šçŸ¥è¡¨ç¤ºæ›´æ–°
    updateNotificationDisplay() {
        const notificationList = document.querySelector('.notification-list');
        if (notificationList && this.notifications.length > 0) {
            const latestNotification = this.notifications[this.notifications.length - 1];

            const notificationElement = document.createElement('div');
            notificationElement.className = 'notification-item';
            notificationElement.innerHTML = `
                <i class="${latestNotification.icon} ${latestNotification.type}"></i>
                <span>${latestNotification.message}</span>
            `;

            notificationList.appendChild(notificationElement);
        }
    }

    // ä¿é™ºè©³ç´°è¡¨ç¤º
    showInsuranceDetails(insuranceType) {
        alert(`${insuranceType}ã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚\n\nç¾åœ¨ã®è£œå„Ÿå†…å®¹ã‚’ç¢ºèªã—ã€é©åˆ‡ãªè¦‹ç›´ã—æ¡ˆã‚’ã”ææ¡ˆã„ãŸã—ã¾ã™ã€‚`);
    }

    // ä¿é™ºæ¨å¥¨è¡¨ç¤º
    showInsuranceRecommendation(insuranceType) {
        alert(`${insuranceType}ã®ã”ææ¡ˆ\n\nè²´ç¤¾ã®ãƒªã‚¹ã‚¯åˆ†æçµæœã«åŸºã¥ãã€${insuranceType}ã®å°å…¥ã‚’ãŠå‹§ã‚ã„ãŸã—ã¾ã™ã€‚\n\nè©³ç´°ãªè¦‹ç©ã‚‚ã‚Šã‚’ã”å¸Œæœ›ã®å ´åˆã¯ã€æ‹…å½“è€…ã«ãŠå£°ãŒã‘ãã ã•ã„ã€‚`);
    }

    // è£œå„Ÿè¦‹ç›´ã—è¡¨ç¤º
    showCoverageReview(insuranceType) {
        alert(`${insuranceType}ã®è£œå„Ÿè¦‹ç›´ã—\n\nç¾åœ¨ã®äº‹æ¥­è¦æ¨¡ã¨æ¯”è¼ƒã—ã¦ã€è£œå„Ÿé¡ã®èª¿æ•´ãŒå¿…è¦ãªå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\n\nç„¡æ–™è¨ºæ–­ã‚’ã”å¸Œæœ›ã®å ´åˆã¯ã€ãŠæ°—è»½ã«ãŠç”³ã—ä»˜ã‘ãã ã•ã„ã€‚`);
    }

    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
    showActionDialog(title, message) {
        alert(`${title}\n\n${message}`);
    }

    // æ¨å¥¨ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
    showRecommendationDialog(title, message) {
        alert(`${title}\n\n${message}\n\næ‹…å½“è€…ã‚ˆã‚Šè©³ç´°ã‚’ã”é€£çµ¡ã„ãŸã—ã¾ã™ã€‚`);
    }

    // ç·Šæ€¥ã‚¢ãƒ©ãƒ¼ãƒˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
    showCriticalAlertDialog(alert) {
        const message = `ã€ç·Šæ€¥å¯¾å¿œãŒå¿…è¦ã§ã™ã€‘\n\n${alert.title}\n\n${alert.description}\n\n${alert.coverageText}\n\nå³åº§ã«å¯¾ç­–æœ¬éƒ¨ã‚’è¨­ç½®ã—ã€ä»¥ä¸‹ã®å¯¾å¿œã‚’å®Ÿæ–½ã—ã¦ãã ã•ã„ï¼š\n1. ç¾åœ°çŠ¶æ³ã®ç¢ºèª\n2. åœ¨åº«ãƒ»è¨­å‚™ã®ç·Šæ€¥ç§»å‹•\n3. ä¿é™ºä¼šç¤¾ã¸ã®é€£çµ¡\n4. ä»£æ›¿æ‹ ç‚¹ã®ç¢ºä¿`;

        if (confirm(message + '\n\nå¯¾ç­–æœ¬éƒ¨ã‚’è¨­ç½®ã—ã¾ã™ã‹ï¼Ÿ')) {
            this.activateEmergencyResponse(alert);
        }
    }

    // é«˜ãƒªã‚¹ã‚¯ã‚¢ãƒ©ãƒ¼ãƒˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
    showHighAlertDialog(alert) {
        const message = `ã€é«˜ãƒªã‚¹ã‚¯è­¦å‘Šã€‘\n\n${alert.title}\n\n${alert.description}\n\n${alert.coverageText}\n\næ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼š\n1. å–å¼•æ¡ä»¶ã®è¦‹ç›´ã—\n2. ä¿¡ç”¨ä¿é™ºã®æ¤œè¨\n3. å®šæœŸçš„ãªä¿¡ç”¨èª¿æŸ»\n4. å–å¼•åˆ†æ•£ã®æ¤œè¨`;

        alert(message);
    }

    // ã‚¢ãƒ©ãƒ¼ãƒˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
    showAlertDialog(alert) {
        alert(`${alert.title}\n\n${alert.description}\n\n${alert.coverageText}`);
    }

    // ç½å®³ãƒªã‚¹ã‚¯è©³ç´°è¡¨ç¤º
    showDisasterRiskDetails(disasterData) {
        const message = `ã€ç½å®³ãƒªã‚¹ã‚¯è©³ç´°ã€‘\n\næ‹ ç‚¹: ${disasterData.location}\nãƒªã‚¹ã‚¯ç¨®é¡: ${disasterData.type}\nç™ºç”Ÿç¢ºç‡: ${disasterData.probability}%\n\næ¨å¥¨å¯¾ç­–ï¼š\n1. å®šæœŸçš„ãªé˜²ç½è¨“ç·´ã®å®Ÿæ–½\n2. ç½å®³å¯¾å¿œãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã®æ•´å‚™\n3. ä¿é™ºè£œå„Ÿå†…å®¹ã®ç¢ºèª\n4. ä»£æ›¿æ‹ ç‚¹ã®æº–å‚™`;

        alert(message);
    }

    // ä¿¡ç”¨ãƒªã‚¹ã‚¯è©³ç´°è¡¨ç¤º
    showCreditRiskDetails(creditData) {
        const riskLevel = creditData.level === 'high' ? 'é«˜ãƒªã‚¹ã‚¯' :
                         creditData.level === 'medium' ? 'ä¸­ãƒªã‚¹ã‚¯' : 'ä½ãƒªã‚¹ã‚¯';

        const message = `ã€å–å¼•å…ˆä¿¡ç”¨ãƒªã‚¹ã‚¯è©³ç´°ã€‘\n\nä¼æ¥­å: ${creditData.company}\nãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢: ${creditData.score}\nãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«: ${riskLevel}\n\næ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼š\n1. å®šæœŸçš„ãªä¿¡ç”¨èª¿æŸ»\n2. å–å¼•æ¡ä»¶ã®è¦‹ç›´ã—\n3. å‚µæ¨©ä¿å…¨ç­–ã®æ¤œè¨\n4. å–å¼•ä¿¡ç”¨ä¿é™ºã®æ´»ç”¨`;

        alert(message);
    }

    // åœ¨åº«ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤º
    showInventoryTooltip(trendData, barElement) {
        // ç°¡æ˜“ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤ºï¼ˆå®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã‚ˆã‚Šæ´—ç·´ã•ã‚ŒãŸãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ï¼‰
        const existingTooltip = document.querySelector('.inventory-tooltip');
        if (existingTooltip) {
            existingTooltip.remove();
        }

        const tooltip = document.createElement('div');
        tooltip.className = 'inventory-tooltip';
        tooltip.innerHTML = `
            <div style="background: #2c3e50; color: white; padding: 8px 12px; border-radius: 4px; font-size: 12px; position: absolute; z-index: 1000;">
                ${trendData.month}: ${trendData.value}Må††
                ${trendData.warning ? '<br><span style="color: #f39c12;">âš  åœ¨åº«éå¤šè­¦å‘Š</span>' : ''}
            </div>
        `;

        const rect = barElement.getBoundingClientRect();
        tooltip.style.position = 'absolute';
        tooltip.style.left = rect.left + 'px';
        tooltip.style.top = (rect.top - 60) + 'px';

        document.body.appendChild(tooltip);

        // 3ç§’å¾Œã«è‡ªå‹•å‰Šé™¤
        setTimeout(() => {
            if (tooltip.parentNode) {
                tooltip.parentNode.removeChild(tooltip);
            }
        }, 3000);
    }

    // ã‚µãƒãƒªãƒ¼è©³ç´°è¡¨ç¤º
    showSummaryDetails(cardType) {
        let message = '';

        switch (cardType) {
            case 'critical':
                message = 'ã€ç·Šæ€¥å¯¾å¿œå¿…è¦æ¡ˆä»¶ã€‘\n\n1. æ´ªæ°´ãƒªã‚¹ã‚¯è­¦å‘Šï¼ˆåŸ¼ç‰å€‰åº«ï¼‰\n2. å–å¼•å…ˆä¿¡ç”¨ãƒªã‚¹ã‚¯ï¼ˆABCå•†äº‹ï¼‰\n\nå³åº§ã«å¯¾å¿œãŒå¿…è¦ã§ã™ã€‚';
                break;
            case 'high':
                message = 'ã€é«˜ãƒªã‚¹ã‚¯æ¡ˆä»¶ã€‘\n\n1. ã‚·ã‚¹ãƒ†ãƒ è„†å¼±æ€§\n2. åœ¨åº«éå¤šãƒªã‚¹ã‚¯\n3. å¾“æ¥­å“¡å®‰å…¨ãƒªã‚¹ã‚¯\n4. ç‚ºæ›¿å¤‰å‹•ãƒªã‚¹ã‚¯\n5. ç«¶åˆä»–ç¤¾å‚å…¥ãƒªã‚¹ã‚¯\n\nè¨ˆç”»çš„ãªå¯¾å¿œã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚';
                break;
            case 'medium':
                message = 'ã€ä¸­ãƒªã‚¹ã‚¯æ¡ˆä»¶ã€‘\n\n8ä»¶ã®ä¸­ãƒªã‚¹ã‚¯æ¡ˆä»¶ãŒã‚ã‚Šã¾ã™ã€‚\nå®šæœŸçš„ãªç›£è¦–ã¨äºˆé˜²çš„å¯¾ç­–ã‚’ç¶™ç¶šã—ã¦ãã ã•ã„ã€‚';
                break;
            case 'coverage':
                message = `ã€ä¿é™ºã‚«ãƒãƒ¼ç‡è©³ç´°ã€‘\n\nç¾åœ¨ã®ã‚«ãƒãƒ¼ç‡: ${this.riskSummary.coverageRate}%\n\næœªã‚«ãƒãƒ¼é …ç›®ï¼š\n- ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£\n- æ´ªæ°´ç½å®³ï¼ˆä¸€éƒ¨åœ°åŸŸï¼‰\n- å¸‚å ´ãƒªã‚¹ã‚¯\n\nä¿é™ºè¦‹ç›´ã—ã‚’æ¨å¥¨ã—ã¾ã™ã€‚`;
                break;
        }

        alert(message);
    }

    // ç·Šæ€¥å¯¾å¿œã‚·ã‚¹ãƒ†ãƒ èµ·å‹•
    activateEmergencyResponse(alert) {
        // ç·Šæ€¥å¯¾å¿œã‚·ã‚¹ãƒ†ãƒ ã®æ¨¡æ“¬å®Ÿè£…
        this.addNotification({
            type: 'critical',
            message: `ç·Šæ€¥å¯¾å¿œã‚·ã‚¹ãƒ†ãƒ ãŒèµ·å‹•ã•ã‚Œã¾ã—ãŸ - ${alert.title}`,
            icon: 'fas fa-exclamation-circle'
        });

        // é€šçŸ¥éŸ³ã‚„ã‚¢ãƒ©ãƒ¼ãƒˆã®å®Ÿè£…ï¼ˆå®Ÿéš›ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯éŸ³å£°ã‚„ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ï¼‰
        console.log('ğŸš¨ ç·Šæ€¥å¯¾å¿œã‚·ã‚¹ãƒ†ãƒ èµ·å‹•:', alert.title);

        // é–¢ä¿‚è€…ã¸ã®é€šçŸ¥ï¼ˆæ¨¡æ“¬ï¼‰
        setTimeout(() => {
            this.addNotification({
                type: 'info',
                message: 'é–¢ä¿‚éƒ¨ç½²ã«ç·Šæ€¥å¯¾å¿œã®æŒ‡ç¤ºã‚’é€ä¿¡ã—ã¾ã—ãŸ',
                icon: 'fas fa-paper-plane'
            });
        }, 2000);
    }

    // ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    loadDummyData() {
        // ä¿é™ºå¥‘ç´„ãƒ‡ãƒ¼ã‚¿
        this.insuranceData = [
            {
                id: 1,
                type: 'ç«ç½ä¿é™º',
                product: 'ä¼æ¥­ç·åˆä¿é™º',
                company: 'â—‹â—‹æä¿',
                startDate: '2023-03-15',
                endDate: '2024-03-15',
                coverage: 'å»ºç‰©ãƒ»è¨­å‚™ 5å„„å††',
                status: 'warning'
            },
            {
                id: 2,
                type: 'è³ å„Ÿè²¬ä»»ä¿é™º',
                product: 'PLä¿é™º',
                company: 'â–³â–³æµ·ä¸Š',
                startDate: '2023-04-01',
                endDate: '2024-03-31',
                coverage: 'å¯¾äººãƒ»å¯¾ç‰© 1å„„å††',
                status: 'ok'
            },
            {
                id: 3,
                type: 'åŠ´ç½ä¿é™º',
                product: 'åŠ´ç½ä¸Šä¹—ã›ä¿é™º',
                company: 'â–¡â–¡ç”Ÿå‘½',
                startDate: '2023-04-01',
                endDate: '2024-03-31',
                coverage: 'æ­»äº¡ãƒ»å¾Œéºéšœå®³ 5000ä¸‡å††',
                status: 'ok'
            }
        ];

        // ãƒªã‚¹ã‚¯ãƒ‡ãƒ¼ã‚¿
        this.riskData = {
            totalScore: 75,
            categories: {
                fire: { level: 20, label: 'ä½' },
                liability: { level: 60, label: 'ä¸­' },
                management: { level: 40, label: 'ä¸­' }
            },
            coverage: 78
        };

        // æ¥­å‹™ãƒ‡ãƒ¼ã‚¿
        this.businessData = {
            sales: {
                current: 15240000,
                change: 12.3
            },
            inventory: {
                items: 1245,
                change: -5.2
            },
            customers: {
                active: 342,
                change: 8.7
            },
            insurance: {
                contracts: 12,
                status: 'ok'
            }
        };

        // åˆæœŸé€šçŸ¥
        this.notifications = [
            {
                id: 1,
                type: 'warning',
                message: 'ç«ç½ä¿é™ºã®æ›´æ–°æœŸé™ãŒè¿‘ã¥ã„ã¦ã„ã¾ã™ï¼ˆ2024å¹´3æœˆ15æ—¥ï¼‰',
                icon: 'fas fa-exclamation-triangle',
                timestamp: new Date()
            },
            {
                id: 2,
                type: 'info',
                message: 'æ–°ã—ã„ãƒªã‚¹ã‚¯è©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆãŒåˆ©ç”¨å¯èƒ½ã§ã™',
                icon: 'fas fa-info-circle',
                timestamp: new Date()
            },
            {
                id: 3,
                type: 'success',
                message: 'Risk Lanceèªå®šä¼æ¥­ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã§Aãƒ©ãƒ³ã‚¯ã‚’é”æˆã—ã¾ã—ãŸ',
                icon: 'fas fa-trophy',
                timestamp: new Date()
            }
        ];

        // ç·Šæ€¥ã‚¢ãƒ©ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿
        this.emergencyAlerts = [
            {
                id: 1,
                level: 'critical',
                title: 'ç·Šæ€¥: æ´ªæ°´ãƒªã‚¹ã‚¯è­¦å‘Š',
                description: 'å€‰åº«æ‰€åœ¨åœ°ï¼ˆåŸ¼ç‰çœŒè¶Šè°·å¸‚ï¼‰ã§48æ™‚é–“ä»¥å†…ã«æ´ªæ°´ç™ºç”Ÿã®å¯èƒ½æ€§ï¼ˆ65%ï¼‰',
                coverage: 'uncovered',
                coverageText: 'ä¿é™ºã‚«ãƒãƒ¼: ãªã—',
                action: 'å¯¾ç­–ã‚’ç¢ºèª',
                icon: 'fas fa-exclamation-triangle'
            },
            {
                id: 2,
                level: 'high',
                title: 'å–å¼•å…ˆä¿¡ç”¨ãƒªã‚¹ã‚¯',
                description: 'ä¸»è¦å–å¼•å…ˆã®é–¢é€£ä¼šç¤¾ï¼ˆABCå•†äº‹é–¢é€£2ç¤¾ï¼‰ãŒå‚µå‹™è¶…éçŠ¶æ…‹',
                coverage: 'partial',
                coverageText: 'ä¿é™ºã‚«ãƒãƒ¼: éƒ¨åˆ†çš„',
                action: 'è©³ç´°ç¢ºèª',
                icon: 'fas fa-building'
            }
        ];

        // ç¤¾å†…ãƒªã‚¹ã‚¯ãƒ‡ãƒ¼ã‚¿
        this.internalRiskData = {
            inventory: {
                trends: [
                    { month: '4æœˆ', value: 12, height: '60%' },
                    { month: '5æœˆ', value: 15, height: '75%' },
                    { month: '6æœˆ', value: 17, height: '85%' },
                    { month: '7æœˆ', value: 18, height: '90%' },
                    { month: '8æœˆ', value: 19, height: '95%' },
                    { month: '9æœˆ', value: 20, height: '100%', warning: true }
                ],
                riskLevel: 'medium',
                coverage: { status: 'covered', text: 'ç«ç½ä¿é™º: 80%ã‚«ãƒãƒ¼' }
            },
            employees: {
                safe: 40,
                caution: 35,
                highRisk: 25,
                total: 245,
                riskLevel: 'high',
                coverage: { status: 'covered', text: 'åŠ´ç½ä¿é™º: 100%ã‚«ãƒãƒ¼' }
            },
            cybersecurity: {
                vulnerabilityTrend: 'increasing',
                riskLevel: 'high',
                coverage: { status: 'uncovered', text: 'ã‚µã‚¤ãƒãƒ¼ä¿é™º: æœªåŠ å…¥' }
            }
        };

        // ç¤¾å¤–ãƒªã‚¹ã‚¯ãƒ‡ãƒ¼ã‚¿
        this.externalRiskData = {
            disasters: [
                {
                    location: 'åŸ¼ç‰å€‰åº«',
                    type: 'æ´ªæ°´ãƒªã‚¹ã‚¯',
                    probability: 65,
                    level: 'high-risk',
                    icon: 'fas fa-water'
                },
                {
                    location: 'æ±äº¬æœ¬ç¤¾',
                    type: 'åœ°éœ‡ãƒªã‚¹ã‚¯',
                    probability: 35,
                    level: 'medium-risk',
                    icon: 'fas fa-home'
                },
                {
                    location: 'å¤§é˜ªæ”¯åº—',
                    type: 'ç·åˆãƒªã‚¹ã‚¯',
                    probability: 15,
                    level: 'low-risk',
                    icon: 'fas fa-building'
                }
            ],
            creditRisk: [
                {
                    company: 'ABCå•†äº‹',
                    score: 85,
                    level: 'high'
                },
                {
                    company: 'XYZå·¥æ¥­',
                    score: 45,
                    level: 'medium'
                },
                {
                    company: 'DEFç‰©æµ',
                    score: 20,
                    level: 'low'
                }
            ],
            marketRisk: {
                gauge: 45, // åº¦æ•°ï¼ˆ0-180ï¼‰
                factors: [
                    { name: 'åŸææ–™ä¾¡æ ¼', trend: 'up', value: '+15%' },
                    { name: 'ç‚ºæ›¿å¤‰å‹•', trend: 'down', value: '-8%' },
                    { name: 'ç«¶åˆä»–ç¤¾', trend: 'up', value: '+3ç¤¾' }
                ],
                riskLevel: 'medium',
                coverage: { status: 'uncovered', text: 'å¸‚å ´ãƒªã‚¹ã‚¯: ä¿é™ºé©ç”¨å¤–' }
            }
        };

        // ç·åˆãƒªã‚¹ã‚¯ã‚µãƒãƒªãƒ¼
        this.riskSummary = {
            critical: 2,
            high: 5,
            medium: 8,
            coverageRate: 68
        };
    }
}

// ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–
document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM loaded, initializing RiskLanceApp'); // ãƒ‡ãƒãƒƒã‚°ç”¨
    window.riskLanceApp = new RiskLanceApp();
});

// è¿½åŠ ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°

// æ•°å€¤ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°
function formatNumber(num) {
    return num.toLocaleString('ja-JP');
}

// æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°
function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('ja-JP', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit'
    });
}

// ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸è¨ˆç®—é–¢æ•°
function calculatePercentage(value, total) {
    return Math.round((value / total) * 100);
}

// ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«åˆ¤å®šé–¢æ•°
function getRiskLevel(score) {
    if (score <= 30) return { level: 'low', label: 'ä½', color: '#27ae60' };
    if (score <= 70) return { level: 'medium', label: 'ä¸­', color: '#f39c12' };
    return { level: 'high', label: 'é«˜', color: '#e74c3c' };
}

// ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå®šæœŸå®Ÿè¡Œï¼‰
setInterval(() => {
    if (window.riskLanceApp && window.riskLanceApp.currentUser) {
        // 5åˆ†ã”ã¨ã«ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
        if (window.riskLanceApp.currentScreen === 'dashboard') {
            window.riskLanceApp.simulateDataUpdate();
        }
    }
}, 300000); // 5åˆ† = 300,000ãƒŸãƒªç§’

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†æ™‚ã®å‡¦ç†
window.addEventListener('load', () => {
    console.log('Risk Lance ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸ');

    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    const progressBars = document.querySelectorAll('.progress');
    progressBars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0%';
        setTimeout(() => {
            bar.style.width = width;
        }, 500);
    });

    // ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚µãƒ¼ã‚¯ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    const coverageBars = document.querySelectorAll('.covered');
    coverageBars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0%';
        setTimeout(() => {
            bar.style.width = width;
        }, 1000);
    });
});

// ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
window.addEventListener('error', (e) => {
    console.error('ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼:', e.error);
});

// ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
window.addEventListener('resize', () => {
    // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºå¤‰æ›´æ™‚ã®å‡¦ç†
    if (window.innerWidth <= 768) {
        // ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºæ™‚ã®å‡¦ç†
        document.body.classList.add('mobile-view');
    } else {
        document.body.classList.remove('mobile-view');
    }
});